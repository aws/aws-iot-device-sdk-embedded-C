<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>AWSIoTCSDK: Thing Shadow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.2 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Thing Shadow </h1>  </div>
</div>
<div class="contents">
<p>Thing Shadow module implements the JSON based protocol of the AWS IoT Thing Shadow Service. The SDK currently supports only one Thing Name for a device. Though the device can update any "Thing" using the Thing Name. A Device can perform update, get and delete action on its own or any Thing Shadow. There are totally 3 Key value pair a device needs to concerned about.</p>
<ul>
<li>reported</li>
<li>desired</li>
<li>delta All these keys are under the "state".</li>
</ul>
<p>The device will always receive a delta message if there is any difference between the desired and the reported section of the device. Unless there is no call made to the <a class="el" href="aws__iot__shadow__interface_8h.html#a2018994362d1ecc99af2151227d5bb41" title="This function is used to listen on the delta topic of AWS_IOT_MY_THING_NAME mentioned in the aws_iot_...">aws_iot_shadow_register_delta()</a>, The SDK will not subscribe to the delta topic.</p>
<h2><a class="anchor" id="response"></a>
Shadow Acknowledgments</h2>
<p>If we want to perform an Update to a thing shadow and get the acknowledgment of the action. One of two things can happen, The update action could be accepted by the Thing Shadow and the version of the JSON document will be updated. The update request could also be rejected.</p>
<p>To know one way or the other, we need to subscribe to the 2 topics: $aws/things/{thingName}/shadow/update/accepted and $aws/things/{thingName}/shadow/update/rejected . One issue with this approach is that, There could be multiple devices trying to update the same shadow. Then it becomes impossible to know if was our update or the other apps. To avoid this we include a client token string to the request. It is of the form: "clientToken": "UniqueClientID+Seq". We use the MQTT client ID <a class="el" href="aws__iot__config_8h.html#a508462ce0da61fccdc537b70d50778aa" title="MQTT client ID should be unique for every device.">AWS_IOT_MQTT_CLIENT_ID</a> (as it has to be unique for one AWS account) with a sequence number to differentiate between our previous update requests.</p>
<p>This is taken care for you by the APIs in <a class="el" href="aws__iot__shadow__json__data_8h.html" title="This file is the interface for all the Shadow related JSON functions.">aws_iot_shadow_json_data.h</a> file. In particular the <a class="el" href="aws__iot__shadow__json__data_8h.html#acc1c9fe2e514d9b46d659ad4161d0a54" title="Finalize the JSON document with Shadow expected client Token.">aws_iot_finalize_json_document()</a> adds the client token to the JSON request</p>
<h2><a class="anchor" id="shadowJson"></a>
Shadow JSON construction</h2>
<p>There are APIs to help you in constructing a JSON update request in the <a class="el" href="aws__iot__shadow__json__data_8h.html" title="This file is the interface for all the Shadow related JSON functions.">aws_iot_shadow_json_data.h</a> file. More about the usage could be found in the <a class="el" href="shadow__sample_8c.html" title="A simple connected window example demonstrating the use of Thing Shadow.">shadow_sample.c</a> file. The update request construction should happen in this order. 1. <a class="el" href="aws__iot__shadow__json__data_8h.html#aaf7b4fdf63d89d0d94c908773b4d672f" title="Initialize the JSON document with Shadow expected name/value.">aws_iot_shadow_init_json_document()</a> 2. <a class="el" href="aws__iot__shadow__json__data_8h.html#a9750d185786fce0d842cf7615905a122" title="Add the reported section of the JSON document of jsonStruct_t.">aws_iot_shadow_add_reported()</a> </p>
<dl class="note"><dt><b>Note:</b></dt><dd>desired and reported section are not mandatory. Most devices might just use the reported section 3. <a class="el" href="aws__iot__shadow__json__data_8h.html#ad4e3bbcfa3d4493d5885af8a26c59acc" title="Add the desired section of the JSON document of jsonStruct_t.">aws_iot_shadow_add_desired()</a> 4. <a class="el" href="aws__iot__shadow__json__data_8h.html#acc1c9fe2e514d9b46d659ad4161d0a54" title="Finalize the JSON document with Shadow expected client Token.">aws_iot_finalize_json_document()</a> </dd>
<dd>
These APIs are there for the convenience and needs to be used with care. In the future revisions ideally this will be replaced with Auto code generation capabilities as most of the devices dont need dynamic configuration of the JSON document. </dd></dl>
<h3><a class="anchor" id="jsonlib"></a>
JSON Library</h3>
<p>The JSON library used for this SDK is <a href="http://zserge.com/jsmn.html">JSMN </a> . This library is not using any dynamic memory allocation.</p>
<h2><a class="anchor" id="configShadow"></a>
Configuration</h2>
<p><a class="el" href="aws__iot__config_8h.html#a3072be59f0ef2b033cd04a6deb1c5d36" title="Maximum size of the SHADOW buffer to store the received Shadow message.">SHADOW_MAX_SIZE_OF_RX_BUFFER</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a56207bd83241b9d3725cb1f0fcddc812" title="Maximum size of the Unique Client Id. For More info on the Client Id refer Acknowledgments.">MAX_SIZE_OF_UNIQUE_CLIENT_ID_BYTES</a></p>
<p><a class="el" href="aws__iot__config_8h.html#af2fa43a4252a6063ec0de1f52cf5ef13" title="This is size of the extra sequence number that will be appended to the Unique client Id...">MAX_SIZE_CLIENT_ID_WITH_SEQUENCE</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a40b29ae9b25643591d53bba30f4a2254" title="This is size of the the total clientToken key and value pair in the JSON.">MAX_SIZE_CLIENT_TOKEN_CLIENT_SEQUENCE</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a5a4c1a56ea1abf6c52893aa3c9852c7a" title="At Any given time we will wait for this many responses. This will correlate to the rate at which the ...">MAX_ACKS_TO_COMEIN_AT_ANY_GIVEN_TIME</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a939c2ffb6c613b59b9d90e18f8ace026" title="We could perform shadow action on any thing Name and this is maximum Thing Names we can act on at any...">MAX_THINGNAME_HANDLED_AT_ANY_GIVEN_TIME</a></p>
<p><a class="el" href="aws__iot__config_8h.html#ad68f57bee9eb5d5e704e02766fb73f9a" title="These are the max tokens that is expected to be in the Shadow JSON document. Include the metadata tha...">MAX_JSON_TOKEN_EXPECTED</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a7c8510e5cd4b15ebea2fc3268cd5bb4a" title="All shadow actions have to be published or subscribed to a topic which is of the format $aws/things/{...">MAX_SHADOW_TOPIC_LENGTH_WITHOUT_THINGNAME</a></p>
<p><a class="el" href="aws__iot__config_8h.html#a826855d821708a27c9480a12528a16ab" title="The Thing Name should not be bigger than this value. Modify this if the Thing Name needs to be bigger...">MAX_SIZE_OF_THING_NAME</a></p>
<p><a class="el" href="aws__iot__config_8h.html#aa6da50cf5e41405ab4367a3a987e576a" title="This size includes the length of topic with Thing Name.">MAX_SHADOW_TOPIC_LENGTH_BYTES</a></p>
<h2><a class="anchor" id="bugsShadow"></a>
Known Issues</h2>
<ul>
<li>No nested JSON can be parsed by the <code><a class="el" href="aws__iot__shadow__json__data_8h.html#a429dd7999755780be803c160a8f72549" title="This is a static JSON object that could be used in code.">jsonStruct_t</a></code> </li>
<li>The device can assume only one thing name </li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 6 2015 19:22:22 for AWSIoTCSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
